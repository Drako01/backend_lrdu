# Activa rewrite
RewriteEngine On

# IMPORTANTE: subdominio apuntando a /public_html/back -> base = /
RewriteBase /

# No reescribir si es archivo/carpeta real
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Enviar todo a index.php
RewriteRule ^ index.php [QSA,L]

# Asegurar que PHP "vea" HTTPS detrás de Cloudflare (por si PHP no lo detecta)
SetEnvIfNoCase X-Forwarded-Proto "https" HTTPS=on

# PROTECCIÓN: negar acceso a archivos sensibles
<FilesMatch "^(?:\.env|composer\.(?:json|lock|phar)|README\.md|LICENSE|.*\.sql|.*\.sh)$">
  Require all denied
</FilesMatch>

# PROTECCIÓN: carpetas que jamás deben servirse
RedirectMatch 404 ^/(?:vendor|sql|tests|\.git|\.vscode)(/|$)

# Opcional: cache estático (tuneable)
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/png "access plus 1 month"
  ExpiresByType image/svg+xml "access plus 1 month"
  ExpiresByType image/webp "access plus 1 month"
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/json "access plus 1 week"
</IfModule>
