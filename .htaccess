# ==== Seguridad & compatibilidad
Options -Indexes -MultiViews

# ==== Pasar Authorization a PHP (CGI/FPM)
CGIPassAuth On
SetEnvIfNoCase Authorization "^(.*)$" HTTP_AUTHORIZATION=$1

RewriteEngine On

# ðŸ”’ Bloquear ejecuciÃ³n de scripts dentro de /multimedia (antes que nada)
RewriteRule ^multimedia/.*\.(?:php|phtml|phar|cgi|pl|py)$ - [F,NC]

# No reescribir si es archivo/carpeta real
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Extra: si llega Authorization por header, exponerlo a PHP
RewriteCond %{HTTP:Authorization} .
RewriteRule ^ - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

# Alias legible para el front
RewriteRule ^auth/products/?$ productos [QSA,NC,L]

# Front controller: todo a index.php
RewriteRule ^ index.php [QSA,L]

# HTTPS detrÃ¡s de Cloudflare/proxy
SetEnvIfNoCase X-Forwarded-Proto "^https$" HTTPS=on

# Proteger archivos sensibles
<FilesMatch "^(?:\.env|composer\.(?:json|lock|phar)|README\.md|LICENSE|.*\.(sql|sh))$">
  Require all denied
</FilesMatch>

# Bloquear carpetas internas
RedirectMatch 404 ^/(?:vendor|tests|\.git|\.vscode)(/|$)

# Cache de estÃ¡ticos (opcional)
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/png "access plus 1 month"
  ExpiresByType image/jpeg "access plus 1 month"
  ExpiresByType image/webp "access plus 1 month"
  ExpiresByType image/gif "access plus 1 month"
  ExpiresByType video/mp4 "access plus 7 days"
  ExpiresByType video/webm "access plus 7 days"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/json "access plus 1 week"
</IfModule>
